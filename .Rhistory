rs_batchExcel3()
rs_graph <- function(reffinderlist, filename = "", forceSingle = FALSE, width, height, units = "px", res = 250, ordering = "Comprehensive Rank"){
# 2048, 2156, units = "px", res = 250
# names <- names(reffinderlist)
# if(filename==""){
#   cat("No file name provided, attempting to substract name\n")
#   filename <- deparse(substitute(reffinderlist))
#   cat("New file name given\n")
# }
# reffinderlist = rfres
# filename <- paste0(outdir, "/")
# forceSingle = TRUE
if(!is.null(reffinderlist$stabilityTable)){
cat("simplelist, only one dataset\n")
# name <- deparse(substitute(reffinderlist))
# cat(name)
name <- deparse(substitute(reffinderlist))
reffinderlist <- list(reffinderlist)
cat("\nreffinderlist converted\n")
cat(name)
names(reffinderlist) <- gsub("_", " ", name)
cat("reffinderlist renamed\n")
}
if(!is.null(reffinderlist[[1]]$stabilityTable)){
cat("list of lists, maybe more than one dataset\n")
if (forceSingle == FALSE) {
if(filename != ""){
if (missing(width)) {
width = length(reffinderlist) * 675
cat(paste("width set to", width, "\n"))
}
if (missing(height)) {
height = 2156
cat(paste("height set to", height, "\n"))
}
}
rsgraphdraw(reffinderlist, filename, width = width, height = height, units = "px", res = 250,  ordering = ordering)
} else { # forceSingle is TRUE
names <- names(reffinderlist)
if (missing(width)) {
width = 675
}
if (missing(height)) {
height = 2156
}
for (i in 1:length(names)) {
cat(names[i])
cat("\n")
rsgraphdraw(reffinderlist[i], paste0(filename, names[i]), width = width, height = height, units = "px", res = 250, ordering = ordering)
}
}
}
}
#'
#'
#' @examples
#' \dontrun{
#' rs_batchExcel()
#' }
#'
#'
#'
#'
rs_batchExcel3 <- function(input = "", outdir = "", printgraph = TRUE){
filepath <- file.choose()
rfres <- rs_reffinder(rs_loadexceldata(filepath))
outdir <- rsoutdirselect()
if(is.na(outdir)){outdir <- getwd()}
graphtype <- rsgraphtypeselect()
nms <- names(rfres)
#exltype <- rsexltypeselect()
if(graphtype == "single"){
rs_graph(rfres, paste0(outdir,"/"), forceSingle =TRUE)
} else if(graphtype == "multi"){
rs_graph(rfres, paste0(outdir, "/", tools::file_path_sans_ext(basename(filepath))))
}
for (i in 1: length(nms)) {
rs_exceltable(rfres[[i]], paste(outdir, "/", nms[i], sep = ""))
}
}
filepath <- file.choose()
filepath
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = /home/patrick/Desktop/graphtest)
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
#'
#'
#' @examples
#' \dontrun{
#' rs_batchExcel()
#' }
#'
#'
#'
#'
rs_batchExcel3 <- function(input = "", outdir = "", printgraph = TRUE){
if(input = "") filepath <- file.choose()
#'
#'
#' @examples
#' \dontrun{
#' rs_batchExcel()
#' }
#'
#'
#'
#'
rs_batchExcel3 <- function(filepath = "", outdir = "", printgraph = TRUE){
if(filepath == "") filepath <- file.choose()
rfres <- rs_reffinder(rs_loadexceldata(filepath))
if(outdir == "") outdir <- rsoutdirselect()
if(is.na(outdir)){outdir <- getwd()}
graphtype <- rsgraphtypeselect()
nms <- names(rfres)
#exltype <- rsexltypeselect()
if(graphtype == "single"){
rs_graph(rfres, paste0(outdir,"/"), forceSingle =TRUE)
} else if(graphtype == "multi"){
rs_graph(rfres, paste0(outdir, "/", tools::file_path_sans_ext(basename(filepath))))
}
for (i in 1: length(nms)) {
rs_exceltable(rfres[[i]], paste(outdir, "/", nms[i], sep = ""))
}
}
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
library(refSeeker)
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
!is.null(reffinderlist$stabilityTable)
View(reffinderlist)
!is.null(reffinderlist$stabilityTable)
names(reffinderlist)
deparse(substitute(reffinderlist))
!is.null(reffinderlist[[1]]$stabilityTable)
names(reffinderlist)
gsub("_", " ", names(reffinderlist))
reffinderlist
library(refSeeker)
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
gsub("_", " ", names(reffinderlist))
names(reffinderlist)
names(reffinderlist) <- gsub("_", " ", names(reffinderlist))
names(reffinderlist)
library(refSeeker)
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
reffinderlist[i]
rs_graph
library(refSeeker)
library(refSeeker)
rs_graph
remove.packages("refSeeker", lib="~/R/x86_64-pc-linux-gnu-library/4.2")
library(refSeeker)
rs_graph
devtools::load_all("~/Documents/R/refSeeker")
rm(rs_batchExcel3)
rm(rs_graph)
rm(rsgraphdraw)
library(refSeeker)
rs_graph
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
rs_batchExcel3("/home/patrick/OneDrive/Dokumenter/R/refSeeker/inst/exdata/excel-ods-test/Reffinder_data_test.ods", outdir = "/home/patrick/Desktop/graphtest")
rs_batchExcel3()
library(refSeeker)
rs_batchExcel2()
In this vignette we will explore how to perform stability analysis by the RefFinder method. In doing so, stability will be calculated using the four different algorithms; delta Ct, GeNorm, BestKeeper and Normfinder. These stabilties will be ranked for each algorithm and a geometric mean of these ranks is used to arrive at Comprehensive Rank for each target/gene/miRNA.
getwd()
rs_batchExcel2()
rs_batchExcel3
rs_batchExcel3()
library(refSeeker)
library(refSeeker)
set.seed(100)
ct_vals <- matrix(rnorm(5*20, mean = 25), ncol = 5, nrow = 20)
dimnames(ct_vals)[[2]] <-  c("gene1", "gene2", "gene3", "gene4", "gene5")
ct_vals
rs_results <- rs_reffinder(ct_vals)
rs_results <- rs_reffinder(ct_vals)
rs_results
rs_exceltable(rs_results, "./output/folder/sample_excel_tables")
rs_reffinder
rs_graph
rs_graph(rs_results)
rs_graph(rs_results)
rs_results
rs_graph(rs_results)
reffinderlist <- rs_results
!is.null(reffinderlist$stabilityTable)
# Check to see if the provided list is a list of list or "just" a list (one data set).
## Will evaluate to TRUE if we are dealing with a simple list (one data set).
if(!is.null(reffinderlist$stabilityTable)){
cat("simplelist, only one dataset\n")
# name <- deparse(substitute(reffinderlist))
# cat(name)
name <- deparse(substitute(reffinderlist))
reffinderlist <- list(reffinderlist)
cat("\nreffinderlist converted\n")
cat(name)
# names(reffinderlist) <- gsub("_", " ", name)
cat("reffinderlist renamed\n")
}
reffinderlist
rs_results
name
!is.null(reffinderlist[[1]]$stabilityTable)
cat("list of lists, maybe more than one dataset\n")
names(reffinderlist) <- gsub("_", " ", names(reffinderlist))
if (forceSingle == FALSE) {
if(filename != ""){
if (missing(width)) {
width = length(reffinderlist) * 675
cat(paste("width set to", width, "\n"))
}
if (missing(height)) {
height = 2156
cat(paste("height set to", height, "\n"))
}
}
rsgraphdraw(reffinderlist, filename, width = width, height = height, units = "px", res = 250,  ordering = ordering)
} else { # forceSingle is TRUE
names <- names(reffinderlist)
if (missing(width)) {
width = 675
}
if (missing(height)) {
height = 2156
}
for (i in 1:length(names)) {
cat(names[i])
cat("\n")
rsgraphdraw(reffinderlist[i], paste0(filename, names[i]), width = width, height = height, units = "px", res = 250, ordering = ordering)
}
}
forceSingle == FALSE
names
names(reffinderlist)
# name <- deparse(substitute(reffinderlist))
# cat(name)
name <- deparse(substitute(reffinderlist))
name
reffinderlist
library(refSeeker)
library(refSeeker)
The function contained in the refSeeker package has all been given the prefix "rs". Function that are meant to be used by user has the prefix "rs_".
set.seed(100)
ct_vals <- matrix(rnorm(5*20, mean = 25), ncol = 5, nrow = 20)
dimnames(ct_vals)[[2]] <-  c("gene1", "gene2", "gene3", "gene4", "gene5")
ct_vals
rs_results <- rs_reffinder(ct_vals)
rs_results
rs_results
rs_results
reffinderlist <- rs_results
!is.null(reffinderlist$stabilityTable)
# name <- deparse(substitute(reffinderlist))
# cat(name)
name <- deparse(substitute(reffinderlist))
name
name <- "rs_results"
name
reffinderlist <- list(reffinderlist)
reffinderlist
names(reffinderlist) <- gsub("_", " ", name)
cat("list of lists, maybe more than one dataset\n")
names(reffinderlist) <- gsub("_", " ", names(reffinderlist))
forceSingle == FALSE
names
names <- names(reffinderlist)
names
if (missing(width)) {
width = 675
}
width = 675
height = 2156
cat(names[i])
length(names)
i = 1
cat(names[i])
cat("\n")
rsgraphdraw(reffinderlist[i], paste0(filename, names[i]), width = width, height = height, units = "px", res = 250, ordering = ordering)
ordering = "Comprehensive Rank"
rsgraphdraw(reffinderlist, filename, width = width, height = height, units = "px", res = 250,  ordering = ordering)
library(refSeeker)
library(refSeeker)
library(refSeeker)
devtools::load_all("~/Documents/R/refSeeker")
library(refSeeker)
library(refSeeker)
library(refSeeker)
library(refSeeker)
rs_exceltable(rs_results, "./output/folder/sample_excel_tables")
rs_results <- rs_reffinder(ct_vals)
rs_results
set.seed(100)
ct_vals <- matrix(rnorm(5*20, mean = 25), ncol = 5, nrow = 20)
dimnames(ct_vals)[[2]] <-  c("gene1", "gene2", "gene3", "gene4", "gene5")
ct_vals
rs_results <- rs_reffinder(ct_vals)
rs_results <- rs_reffinder(ct_vals)
rs_results
rs_exceltable(rs_results, "./output/folder/sample_excel_tables")
getwd(4)
getwd()
rs_graph(rs_results)
library(refSeeker)
inputData <- rs_loadexceldata("../inst/exdata/vignetteInputs/Reffinder_data_test.xlsx")
rs_normfinder(inputData$Fresh_Frozen)
rs_genorm(inputData$Fresh_Frozen)
rs_bestKeeper(inputData$Fresh_Frozen)
rs_deltaCt(inputData$Fresh_Frozen)
rsresults <- rs_reffinder(inputData)
rsresults <- rs_reffinder(inputData)
rsresults
rs_exceltable(rsresults$Fresh_Frozen, "../inst/exdata/VignettesOutputs/excel_results", addDate = TRUE)
rs_graph(rsresults)
rs_graph(rsresults, "../inst/exdata/VignettesOutputs/refSeeker_excel_results", forceSingle = TRUE, width = 1024)
rs_graph(rsresults, "../inst/exdata/VignettesOutputs/refSeeker_excel_results", forceSingle = TRUE, width = 1024)
getwd()
rs_graph(rsresults, "./inst/exdata/VignettesOutputs/refSeeker_excel_results", forceSingle = TRUE, width = 1024)
reffinderlist <- rsresults
forceSingle = TRUE, width = 1024
forceSingle = TRUE
width = 1024
!is.null(reffinderlist$stabilityTable)
reffinderlist
rsresults
!is.null(reffinderlist[[1]]$stabilityTable)
names(reffinderlist)
gsub("_", " ", names(reffinderlist))
names(reffinderlist) <- gsub("_", " ", names(reffinderlist))
forceSingle == FALSE
names <- names(reffinderlist)
names
width = 675
width = 1024
height = 2156
cat(names[i])
i = 1
cat(names[i])
cat("\n")
ordering = "Comprehensive Rank"
units = "px"
res = 250
filename = ""
if (!requireNamespace("ggplot2", quietly = TRUE)) {
stop(
cat("function stopped due to ggplot2"),
"Package \"ggplot2\" must be installed to use this function.",
call. = FALSE
)
}
ordering[1] != "Targetorder"
if(ordering[1] != "Targetorder"){
for (i in 1:length(reffinderlist)) {
algonames <- names(reffinderlist[[i]]$stabilityTable)
sortcol <- which(algonames == ordering[1])
reffinderlist[[i]]$stabilityTable <- reffinderlist[[i]]$stabilityTable[order(reffinderlist[[i]]$stabilityTable[,sortcol]),]
}
}
reffinderlist
rftable <- data.frame()
## Adding specific identifiers for each stability value
if(is.null(names(reffinderlist))){ # Target names have not been provided
# Add identifier to tables and add them to the new rftable
## If dataset are not named, use ID numbers
for (i in 1:length(reffinderlist)) {
# Add identifier
reffinderlist[[i]]$stabilityTable$dataID <- paste0("ID_", i)
# Add the tables to the rftable
rftable <- rbind(rftable, reffinderlist[[i]]$stabilityTable)
}
} else{ # Target names have been provided
# Add identifier to tables and add them to the new rftable
for (i in 1:length(reffinderlist)) {
# Add identifier
reffinderlist[[i]]$stabilityTable$dataID <- names(reffinderlist)[i]
# Add the tables to the rftable
rftable <- rbind(rftable,reffinderlist[[i]]$stabilityTable)
}
}
is.null(names(reffinderlist))
# Create a holder for the algorithms list
algorithmlist <- names(rftable[2:6])
# Rename targets in each table by adding identifier (normally tissue type)
## necessary for arranging the graphs x-axis individually
rftable$Target <- paste(rftable$Gene, "__", rftable$dataID, sep = "")
# Factorize each target based on the unique identifier
rftable$Target <- factor(rftable$Target, levels = rftable$Target)
# Melt the table
rftable <- reshape2::melt(rftable, c(names(rftable[1]), "dataID", "Target"),
measure.vars = algorithmlist,
variable.name = "algorithm",
value.name = "Stability"
)
paste0(filename, gsub("_", " ", names[i]))
i =1
paste0(filename, gsub("_", " ", names[i])
)
gsub("_", " ", names[i])
gsub(" ", "_", names[i])
library(refSeeker)
filename
library(refSeeker)
library(refSeeker)
rs_graph(rsresults, "../inst/exdata/VignettesOutputs/refSeeker_excel_results", forceSingle = TRUE, width = 1024)
detach("package:refSeeker", unload = TRUE)
remove.packages("refSeeker", lib="~/R/x86_64-pc-linux-gnu-library/4.2")
install.packages("~/OneDrive/Dokumenter/R/refSeeker_0.9.4.tar.gz", repos = NULL, type = "source")
install.packages("~/OneDrive/Dokumenter/R/refSeeker_0.9.4.tar.gz", repos = NULL, type = "source")
install.packages(
"capsule",
repos = c(mm = "https://milesmcbain.r-universe.dev", getOption("repos")))
set.seed(100)
ct_vals <- matrix(rnorm(5*20, mean = 25), ncol = 5, nrow = 20)
dimnames(ct_vals)[[2]] <-  c("gene1", "gene2", "gene3", "gene4", "gene5")
library(refSeeker)
rs_reffinder(ct_vals)
View(Normfinder)
capsule::create()
capsule::create("./R")
library(refSeeker)
library(refSeeker)
library(refSeeker)
library(refsee)
library(refSeeker)
rsload''
rs_loadexceldata()
rs_loadtxtdata()
test <- rs_loadtxtdata()
library(refSeeker)
inp <- rs_loadodsdata()
inp
library(ctrlGene)
geNorm2(inp$Fresh_Frozen)
FIB
geNorm2(FIBct)
decimals = 3
expression <- inp$Fresh_Frozen
gnex <- as.data.frame(expression)
gnex
gnrm <- ctrlGene::geNorm2(expression)
gnrm
gnrm$Avg.M[nrow(gnrm)] <- gnrm$Avg.M[nrow(gnrm)-1]
gnrm
names(gnrm)[1] <- "Target"
gnrm
gnrm$Avg.M <- round(gnrm$Avg.M, digits = decimals)
gnrm
gnrm <- rsaddstabilityrank(gnrm, 2)
gnrm
#gnex <- as.data.frame(expression)
gnrm <- ctrlGene::geNorm2(expression)
# gnrm$Avg.M <- round(gnrm$Avg.M, 3)
gnrm$Avg.M[nrow(gnrm)] <- gnrm$Avg.M[nrow(gnrm)-1]
names(gnrm)[1] <- "Target"
#gnrm <- rsorderbystability(gnrm)
gnrm$Avg.M <- round(gnrm$Avg.M, digits = decimals)
gnrm <- rsaddstabilityrank(gnrm, 2)
gnrm
geNorm(expression)
bestKeeper(expression )
bestKeeper(expression)
rs_bestKeeperFull(expression)
rs_genorm(expression)
View(Normfinder)
texprssion <- t(expression)
View(texprssion)
View(expression)
gexpression <- expression
c(rep(c(1,2), times = 10,9))
rep(c(1,2), times = 10,9)
rep(c(1,2), times = c(10,9))
gexpression$group <- rep(c(1,2), times = c(10,9))
gexpression
#'
#' @param expression
#' @param Groups
#' @param ctVal
#' @param pStabLim
#'
#' @return
#' @export
#'
#' @examples
rs_normfinderFull <- function(expression, Groups=TRUE, ctVal=TRUE, pStabLim=0.25){
if(!file.exists(
paste0(dir(find.package("refSeeker", lib.loc=NULL, quiet = TRUE), pattern = "exdata", recursive = TRUE, full.names = TRUE, include.dirs = TRUE), "/r.NormOldStab5.txt")
)){
utils::download.file("https://moma.dk/files/r.NormOldStab5.txt",
paste0(dir(find.package("refSeeker", lib.loc=NULL, quiet = TRUE), pattern = "exdata", recursive = TRUE, full.names = TRUE, include.dirs = TRUE), "/r.NormOldStab5.txt"),
quiet = FALSE)
rsadjustnmfRounding(decimals = 3)
}
# source the r.NormOldStab5.txt
source(paste0(dir(find.package("refSeeker", lib.loc=NULL, quiet = TRUE), pattern = "exdata", recursive = TRUE, full.names = TRUE, include.dirs = TRUE), "/r.NormOldStab5.txt"))
###################################################################################################################
# write the temporary txt file table for the normfinderfuncton
utils::write.table(data.frame(t(expression)), "expression_temp.txt")
# Calculate the stabilities and save in Results
Results = Normfinder("expression_temp.txt", Groups = Groups, ctVal = ctVal, pStabLim = pStabLim)
# Remove the temporary txt file
unlink("expression_temp.txt")
return(Results)
}
rs_normfinderFull(gexpression)
rs_normfinderFull(expression, Groups = FALSE)
nffull <- rs_normfinderFull(expression, Groups = FALSE)
View(nffull)
rs_reffinder(expresson)
rs_reffinder(expression)
library(refSeeker)
rs_reffinder(expression)
rs_reffinder(inp)
